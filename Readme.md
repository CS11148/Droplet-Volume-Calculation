## Droplet Volume Analysis

This project contains Python code to calculate the total volume of small droplets shed by a large droplet after it falls and hits a surface.

We use videos or images of the event, extract frames from the video, and process each frame to detect and measure the small droplets. The code then adds up the volumes of all these droplets and writes the result to a file.

The main goal is to compare the total volume of the shed droplets with the difference between the initial and final volume of the large droplet:

**Total Shed Volume** vs **(Initial Volume - Final Volume)**

This helps us understand how much volume is lost or conserved during the droplet breakup.


## Imports Used

- `cv2` (OpenCV)
- `os`
- `numpy`
- `matplotlib.pyplot`
- `PIL` (from `Pillow`)
- `sys`
- `skimage.measure` (from `scikit-image`)
- `math`

---

## Automation Script (b.sh)

This script automates the entire process of droplet volume analysis by running the necessary Python scripts sequentially for each image frame.

### How it works:
1. **`vol_clear_file.py`**:  
   Clears the `vol.txt` file to ensure that previous volume calculations do not interfere with the new calculations.
   
2. **Frame Processing Loop**:  
   For each image (`*.png`) in the `frames_output/` folder:
   - **`a.py`**: Applies Fourier Transform filtering to the image to enhance droplet visibility and reduce noise.
   - **`d.py`**: Detects the droplets in the filtered image and writes their individual volumes to `data.txt`.
   - **`v.py`**: Computes the individual droplet volumes from `data.txt` and writes the sum for the current frame to `vol.txt`.

3. **`v1.py`**:  
   After processing all frames, this script sums the droplet volumes from all frames (stored in `vol.txt`) and writes the total volume to `droplet_volume.txt`.

### How to use:
Run the script in the terminal:
  
  ./b.sh

---

### Explanation of Text Files:

- **`data.txt`**:  
  This file contains the individual volumes of droplets detected in a single frame. Each line represents the volume of one droplet, written in pixels.

- **`vol.txt`**:  
  This file stores the sum of the volumes of all the droplets detected in a single frame. It is generated by summing up the volumes from `data.txt` and is used for further calculations.

- **`droplet_volume.txt`**:  
  This file contains the total volume of all droplets across all frames. It is calculated by summing the values from `vol.txt` for each frame, providing an overall measurement of the droplet volumes throughout the entire video or image sequence.

---


## frames.py - Extract Frames from Video

This script extracts one frame every 15 seconds from a video and saves it as a PNG image.

### How it works:
- Loads the input video using OpenCV.
- Moves forward in 15-second intervals.
- Saves each extracted frame as a `.png` file named with the timestamp (e.g., `0m15.png`).
- Stores all the frames in the specified output folder.

### Example usage:
- Update the variables at the bottom of the script
- video_file = "input.mp4"         # Path to your input video
- output_dir = "frames_output"     # Folder to save extracted frames
- extract_frames(video_file, output_dir)


## a.py - Fourier Transform Filtering

This script applies a high-pass Fourier filter to an input image to reduce low-frequency noise and enhance the visibility of small droplets.

### How it works:
- Reads a grayscale image passed as a command-line argument.
- Applies a 2D Fast Fourier Transform (FFT).
- Suppresses low-frequency components (smooth background) using a circular mask.
- Applies inverse FFT to reconstruct the filtered image.
- Saves the result as `output.png`.

### Usage:

Run the script with the image filename as an argument:

python a.py input_image.png


## d.py - Droplet Volume Estimation from Image

This script detects and analyzes small droplets in an image by finding connected components and estimating their sizes.

### How it works:
- Loads a grayscale image (usually preprocessed with Fourier filtering).
- Applies Gaussian blur and Otsu's thresholding to create a binary image.
- Crops the image to a specific region of interest.
- Detects connected components (droplets) and filters them by size.
- Saves a labeled color visualization as `Final_output.png`.
- Writes the droplet sizes (in pixel area) to a file named `data.txt`.

### Example usage:

Just run the script (make sure `output.png` is present in the same directory):

python d.py


## vol.py - Calculate Total Droplet Volume

This script reads droplet area values from a text file and calculates the total volume assuming each droplet is spherical.

### How it works:
- Reads droplet areas from `data.txt` (each line is a droplet’s area in pixels).
- Converts area to radius using:  
  `radius = sqrt(area / π)`
- Calculates volume of each droplet as a sphere:  
  `volume = (4/3) * π * radius³`
- Sums all volumes and appends the result to `vol.txt`.

### Example usage:

python vol.py




## v1.py - Sum Volumes and Calculate Total Droplet Volume

This script sums up the individual summed up droplet volumes and writes the total volume to an output file.

### How it works:
- Reads individual summed up droplet volumes from `vol.txt` (one volume per line).
- Sums all the volumes to calculate the total volume.
- Writes the total volume to `droplet_volume.txt`.

### Example usage:

python v1.py

## vol_clear_file.py - Clear `vol.txt` - Prepare for New Calculations

This script clears the `vol.txt` file to ensure that new droplet volume calculations don't get added to any previous results.

### How it works:
- Opens the `vol.txt` file in write mode (`"w"`), which automatically clears its contents.

### Example usage:

python vol_clear_file.py